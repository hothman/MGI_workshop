# Image of workspace. Learn more: https://www.gitpod.io/docs/configure/workspaces/workspace-image
tasks:
  - name: install rstudioinit
    init: |
      sudo apt-get update 
      sudo apt-get upgrade -y
      sudo apt-get install gdebi-core -y

      sudo source /home/gitpod/.bashrc

      wget https://download2.rstudio.org/server/jammy/amd64/rstudio-server-2023.12.1-402-amd64.deb
      export PATH="/opt/miniforge/bin:${PATH}"
      sudo gdebi -n rstudio-server-2023.12.1-402-amd64.deb
      gp ports visibility 8787:public
      sudo adduser mgi
    command: | 
      wget https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-Linux-x86_64.sh -O \
      miniforge.sh && sudo bash miniforge.sh -b -p /opt/miniforge && rm miniforge.sh
      conda config --add channels bioconda
      conda config --add channels conda-forge 
      sudo mamba install r-base=4.1.3  r-tibble=3.2.1 bioconductor-dada2=1.22.0 -y 


  - name: Open RStudio Tab
    command: gp preview $(gp url 8787) --external

ports:
  # RStudio port
  - port: 8787
    onOpen: notify
    visibility: public    
